<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>HTML5 File Drag &amp; Drop API</title>
<script>
	//===configure===
	//form_action="http://127.0.0.1:8081/";
	//leaving empty is ok when this page was delivered through handler.UploadHandler (?upload_form)
	form_action="";
</script>
<!-- ======================================================================= -->
<style>
/*Styles for HTML5 File Drag & Drop demonstration, Featured on SitePoint.com, Developed by Craig Buckler (@craigbuckler) of OptimalWorks.net*/
/*//tb/1606 mods*/
:root {
	/*css variable, access with var(--var-name)*/
	--progress-bar-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAABnIAAAADCAMAAACQyGFoAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAUpQTFRFAAAAesqDesqCesmDecqDecqCeMqBd8qAd8qBd8p/dsqAdsp/dcp/dcp+dMp+dMp9c8p9csp8c8p8csp7ccp7ccp6cMp6b8p5b8p4bsp4bcp3bcp4bMp2a8p2a8p1asl1asp0acp0acpzaMp0Z8pzZ8pyZspyZspxZspwZcpwZMpwZMpvY8pvY8puYsptYcptYcpsYMpsX8prXspqXcppXcpoXMpoW8pnW8poWspnWspmWcpmWMpmWMplWMpkV8pkVspkVspjVcpiVMpiVMphU8pgUspfUcpfUcpeUMpeUMpdT8pdTspdTspcTspbTMpaTcpaS8pZS8pYScpZScpYScpXSMpXSMpWR8pWRspVRspURcpURMpURMpTQ8pSQ8pTQspRQcpRQMpQP8pPQMpPP8lOP8pOPspOPspNPcpOPcpNPcpMPMpM////iljPEwAAAAF0Uk5TAEDm2GYAAAABYktHRG27BgCtAAAACXBIWXMAAABIAAAASABGyWs+AAABYklEQVRYw+3V31MBURQHcK1+KstWSiQpEon0A4lSLRVpRRRlVSit/f+fO3PPzJ1pmtFMYzydz8P33PNw7338GsYGEgRh4D4ERqMRchwM+2X26p8//7ohMBM/TDJTYJqBwwwymUyzYI4zm82iKFosFkjRarVKkjQPJGYBLDI2m20JLXN2u30FOBwOp9MJuYpcLtcacLvdkOvA4/FsMJvA6/X6fL4tAMPv92+DQCAQDAYhd0AoFNpF4XA4EonsoWg0us8doEPmCMRisXg8nkgkjlEymTwBqVQqnU6fgjMmk8mcgwvmEsiynM1mZRwgl8tdgWvmBuTz+UKhcIuKxeIdUhSlVCop6B6Vy+VKpfKAqtVqrVZ7RE+oXq83Go1n7oVpqqraarWaQGVe0Rv3zrXb7U6n0+12P9An1+v1voCmaf1+X0O6rsOiIwMh5B+ocqhyqHKocggZEaocqhyqHKocQkbjG1BDcqh6FCkVAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE2LTA2LTI0VDEwOjUwOjIxKzAyOjAwN1pbagAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxNi0wNi0yNFQxMDo1MDoyMSswMjowMEYH49YAAAAASUVORK5CYII=');
}

body
{
	font-family: Helvetica, freesans, sans-serif;
	font-size: 90%;
	margin: 10px;
	color: #333;
	background-color: #fff;
}

h1, h2
{
	font-size: 1.5em;
	font-weight: normal;
}

h2
{
	font-size: 1.3em;
}

legend
{
	font-weight: bold;
	color: #333;
}

#upload
{
	width: 840px;
}

#filedrag
{
	display: none;
	height: 200px;
	font-weight: bold;
	text-align: center;
	padding: 1em 0;
	margin: 1em 0;
	color: #555;
	border: 2px dashed #555;
	border-radius: 80px;
	cursor: default;
}

#filedrag.hover
{
	color: #f00;
	border-color: #f00;
	border-style: solid;
	box-shadow: inset 0 3px 80px #888;
}

img
{
	max-width: 100%;
}

pre
{
	width: 95%;
	height: 8em;
	font-family: monospace;
	font-size: 0.9em;
	padding: 1px 2px;
	margin: 0 0 1em auto;
	border: 1px inset #666;
	background-color: #eee;
	overflow: auto;
}

#messages
{
	padding: 0 10px;
	margin: 1em 0;
	border: 1px solid #999;
}

#progress p
{
	display: block;
	width: 800px;
	padding: 2px 5px;
	margin: 2px 0;
	border: 1px inset #446;
	border-radius: 5px;
/*	background: #eee url("progress.png") 100% 0 repeat-y; */
	background: #eee var(--progress-bar-image) 100% 0 repeat-y;
}

#progress p.success
{
	background: #eee none 0 0 no-repeat;
}

#progress p.failed
{
	background: #f00 none 0 0 no-repeat;
}
</style>
</head>
<!-- ======================================================================= -->
<body>
<form id="upload" action="" method="POST" enctype="multipart/form-data">
<fieldset>
<legend>File Upload</legend>
<input type="hidden" id="MAX_FILE_SIZE" name="MAX_FILE_SIZE" value="300000" />
<div>
<center>
<input type="file" id="fileselect" name="fileselect[]" multiple="multiple" />
</center> 
<br/><br/>
<div id="filedrag">or drop files here</div>
</div>
<div id="progress"></div>
</fieldset>
</form>
<!--
<p>The code was developed by <a href="http://twitter.com/craigbuckler">Craig Buckler</a> of <a href="http://optimalworks.net/">OptimalWorks.net</a> for <a href="http://sitepoint.com/">SitePoint.com</a>.</p>
<p>This code can be <a href="http://blogs.sitepointstatic.com/examples/tech/filedrag/3/filedrag3.zip">downloaded and used</a> without any restrictions but please don't expect support! A link back to SitePoint.com is appreciated.</p>
-->
<!-- ======================================================================= -->
<script>
/*filedrag.js - HTML5 File Drag & Drop demonstration, Featured on SitePoint.com, Developed by Craig Buckler (@craigbuckler) of OptimalWorks.net*/
(function()
{
	// getElementById
	function $id(id)
	{
		return document.getElementById(id);
	}

	// output information
	function output(msg)
	{
		var m = $id("messages");
		m.innerHTML = msg + m.innerHTML;
	}

	// file drag hover
	function fileDragHover(e)
	{
		e.stopPropagation();
		e.preventDefault();
		e.target.className = (e.type == "dragover" ? "hover" : "");
	}

	// file selection
	function fileSelectHandler(e)
	{
		// cancel event and hover styling
		fileDragHover(e);

		// fetch FileList object
		var files = e.target.files || e.dataTransfer.files;

		// process all File objects
		for (var i = 0, f; f = files[i]; i++)
		{
			uploadFile(f);
		}
	}

	// upload files
	function uploadFile(file)
	{
		var xhr = new XMLHttpRequest();
///		if (xhr.upload && file.type == "image/png" && file.size <= $id("MAX_FILE_SIZE").value) {
		if (xhr.upload)
		{
			// create progress bar
			var o = $id("progress");
			//var progress = o.appendChild(document.createElement("p"));
			//newest progress bar on top
			var progress = o.insertBefore(document.createElement("p"),o.childNodes[0]);
			progress.appendChild(document.createTextNode(file.name));

			// progress bar
			xhr.upload.addEventListener("progress", function(e)
			{
				var pc = parseInt(100 - (e.loaded / e.total * 100));
				progress.style.backgroundPosition = pc + "% 0";
				if(e.loaded==e.total)
				{
//					console.log("loaded==total");
				}
			}, false);

			//complete
			xhr.upload.addEventListener("load", function(e)
			{
//				console.log("transfer complete");
			}, false);

			//failed
			xhr.upload.addEventListener("error", function(e)
			{
//				console.log("error transfer");
			}, false);

			// file received/failed
			xhr.onreadystatechange = function(e)
			{
				if (xhr.readyState == 4)
				{
					progress.className = (xhr.status == 200 ? "success" : "failure");
				}
			};

			// start upload
			xhr.open("POST", $id("upload").action, true);
			xhr.setRequestHeader("X_FILENAME", file.name);
			xhr.send(file);
		}
	}// end uploadFile()

	// initialize
	function init()
	{
		// set form action from variable
		var form=$id("upload");
		form.action=form_action;

		var fileselect = $id("fileselect"),
			filedrag = $id("filedrag");

		// file select
		fileselect.addEventListener("change", fileSelectHandler, false);

		// is XHR2 available?
		var xhr = new XMLHttpRequest();
		if (xhr.upload)
		{
			// file drop
			filedrag.addEventListener("dragover", fileDragHover, false);
			filedrag.addEventListener("dragleave", fileDragHover, false);
			filedrag.addEventListener("drop", fileSelectHandler, false);
			filedrag.style.display = "block";
		}
		else
		{///
		}
	}

	// call initialization file
	if (window.File && window.FileList && window.FileReader)
	{
		init();
	}
})();
</script>
<!-- ======================================================================= -->
</body>
</html>
